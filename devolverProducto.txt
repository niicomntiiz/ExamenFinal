type Mutation {
    # ...
    returnProduct(productId: ID!): User!
}

export const returnProduct = async (productId: string, userId: string) => {
    const db = getDB();
    const objectIdProduct = new ObjectId(productId);
    const objectIdUser = new ObjectId(userId);

    // 1. Verificamos que el usuario tenga ese producto
    const user = await db.collection(COLLECTION_USERS).findOne({
        _id: objectIdUser,
        products: productId // Busca si el string del ID está en el array
    });

    if (!user) throw new Error("El usuario no tiene este producto o no existe");

    // 2. Aumentamos stock del producto (+1)
    await db.collection(COLLECTION_PRODUCTS).updateOne(
        { _id: objectIdProduct },
        { $inc: { stock: 1 } }
    );

    // 3. Quitamos el ID del array del usuario ($pull)
    // OJO: Si tiene 2 productos iguales, $pull borra todos los que coincidan o uno solo dependiendo de tu lógica.
    // Para simplificar examen: quitamos el producto.
    await db.collection(COLLECTION_USERS).findOneAndUpdate(
        { _id: objectIdUser },
        { $pull: { products: productId } } as any // "as any" a veces es necesario con el driver si se queja del tipo
    );

    return await db.collection(COLLECTION_USERS).findOne({ _id: objectIdUser });
};

returnProduct: async (_, { productId }, { user }) => {
    if (!user) throw new Error("No autenticado");
    return await returnProduct(productId, user._id.toString());
}